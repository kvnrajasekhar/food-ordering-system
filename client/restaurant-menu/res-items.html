<!-- let fooditem = [
{
  id: 1,
  name: "Pizzeria Delights",
  category: "veg",
  cuisine: "Italian",
  rating: 4.5,
  image: "../products/img/Pizzeria Delights.jfif",
  description: "Delicious pizzas with fresh ingredients.",
},
{
  id: 2,
  name: "Golden Dragon",
  category: "nonveg",
  cuisine: "Chinese",
  rating: 4.7,
  image: "../products/img/Golden Dragon.jpg",
  description: "Authentic Chinese flavors.",
},
{
  id: 3,
  name: "Taco Fiesta",
  category: "nonveg",
  cuisine: "Mexican",
  rating: 4.2,
  image: "../products/img/Taco Fiesta.jfif",
  description: "Spicy and flavorful Mexican dishes.",
},
{
  id: 4,
  name: "Paneer Butter Masala",
  category: "veg",
  cuisine: "Indian",
  rating: 4.6,
  image: "../products/img/Paneer Butter Masala.jfif",
  description: "Made with Indian spices and flavors.",
},
{
  id: 5,
  name: "Burger Haven (Chicken)",
  category: "nonveg",
  cuisine: "Fast Food",
  rating: 4.0,
  image: "../products/img/Burger.jfif",
  description: "Juicy chicken burgers and crispy fries.",
},
{
  id: 6,
  name: "Vegetable Biryani",
  category: "veg",
  cuisine: "Indian",
  rating: 4.3,
  image: "../products/img/vegetable-biryani.jpg",
  description: "Aromatic rice with fresh vegetables.",
},
{
  id: 7,
  name: "Veg Meals",
  category: "veg",
  cuisine: "Indian",
  rating: 4.5,
  image: "../products/img/veg-meals-1.jpg",
  description: "A wholesome vegetarian meal.",
},
{
  id: 8,
  name: "Curd Rice",
  category: "veg",
  cuisine: "Indian",
  rating: 4.2,
  image: "../products/img/curd-rice.jfif",
  description: "Refreshing curd rice with spices.",
},
{
  id: 9,
  name: "Dum Biryani (Chicken)",
  category: "nonveg",
  cuisine: "Indian",
  rating: 4.8,
  image: "../products/img/dum_biryani.jfif",
  description: "Flavorful dum-cooked chicken biryani.",
},
{
  id: 10,
  name: "Chicken 65",
  category: "nonveg",
  cuisine: "Indian",
  rating: 4.6,
  image: "../products/img/chicken_65.jfif",
  description: "Spicy and crispy chicken bites.",
},
{
  id: 11,
  name: "Dosa",
  category: "tiffins",
  cuisine: "Indian",
  rating: 4.4,
  image: "../products/img/dosa.jfif",
  description: "Crispy dosa served with chutney.",
},
{
  id: 12,
  name: "Idly",
  category: "tiffins",
  cuisine: "Indian",
  rating: 4.5,
  image: "../products/img/idly.jfif",
  description: "Soft and fluffy idly with sambar.",
},
{
  id: 13,
  name: "Sushi Delight",
  category: "nonveg",
  cuisine: "Japanese",
  rating: 4.8,
  image: "../products/img/Sushi Delight.jfif",
  description: "Fresh and authentic sushi rolls.",
},
{
  id: 14,
  name: "Pad Thai (Chicken)",
  category: "nonveg",
  cuisine: "Thai",
  rating: 4.6,
  image: "../products/img/Pad Thai.jfif",
  description: "Classic Thai stir-fried noodles with chicken.",
},
{
  id: 15,
  name: "Shawarma Wrap (Chicken)",
  category: "nonveg",
  cuisine: "Middle Eastern",
  rating: 4.5,
  image: "../products/img/Shawarma Wrap.jfif",
  description: "Savory and flavorful chicken shawarma wraps.",
},
{
  id: 16,
  name: "Greek Salad",
  category: "veg",
  cuisine: "Greek",
  rating: 4.3,
  image: "../products/img/Greek Salad.jfif",
  description: "Fresh and healthy Greek salad.",
},
{
  id: 17,
  name: "Ramen Bowl (Pork)",
  category: "nonveg",
  cuisine: "Japanese",
  rating: 4.7,
  image: "../products/img/Ramen Bowl.jfif",
  description: "Warm and comforting ramen noodles with pork.",
},
{
  id: 18,
  name: "Falafel Platter",
  category: "veg",
  cuisine: "Middle Eastern",
  rating: 4.4,
  image: "../products/img/Falafel Platter.jfif",
  description: "Crispy falafels with hummus and pita.",
},
{
  id: 19,
  name: "Tom Yum Soup (Shrimp)",
  category: "nonveg",
  cuisine: "Thai",
  rating: 4.5,
  image: "../products/img/Tom Yum Soup.jfif",
  description: "Spicy and tangy Thai soup with shrimp.",
},
{
  id: 20,
  name: "Baklava",
  category: "veg",
  cuisine: "Greek",
  rating: 4.6,
  image: "../products/img/Baklava.jfif",
  description: "Sweet and flaky Greek dessert.",
},
{
  name: "DUM_BIRYANI",
  category: "nonveg",
  image: "./img/dum_biryani.jfif",
  description: "Slow-cooked biryani with aromatic spices.",
},
{
  name: "POT_BIRYANI",
  category: "nonveg",
  image: "./img/pot_biryani.jpg",
  description: "Delicious biryani cooked in a traditional pot.",
},
{
  name: "WINGS_BIRYANI",
  category: "nonveg",
  image: "./img/wings_biryani.jpeg",
  description: "Unique biryani with flavorful chicken wings.",
},
{
  name: "FISH_BIRYANI",
  category: "nonveg",
  image: "./img/fish_biryani.webp",
  description: "Exotic biryani prepared with fresh fish.",
},
{
  name: "FRY_BIRYANI",
  category: "nonveg",
  image: "./img/fry_biryani.jfif",
  description:
    "Crispy fried ingredients blended into a flavorful biryani.",
},
{
  name: "CHICKEN_65",
  category: "nonveg",
  image: "./img/chicken_65.jfif",
  description: "Spicy and tangy chicken appetizer.",
},
{
  name: "CHICKEN_FRY",
  category: "nonveg",
  image: "./img/chicken_fry.jfif",
  description: "Crispy and succulent fried chicken.",
},
{
  name: "MUTTON_BIRYANI",
  category: "nonveg",
  image: "./img/mutton_biryani.jpg",
  description: "Rich and flavorful biryani with tender mutton pieces.",
},
{
  name: "DOSA",
  category: "tiffins",
  image: "./img/dosa.jfif",
  description: "Thin and crispy South Indian crepe.",
},
{
  name: "IDLY",
  category: "tiffins",
  image: "./img/idly.jfif",
  description: "Soft and fluffy steamed rice cakes.",
},
{
  name: "CHAPATI",
  category: "tiffins",
  image: "./img/chapati.jfif",
  description: "Simple and wholesome whole wheat flatbread.",
},
{
  name: "PAROTA",
  category: "tiffins",
  image: "./img/parota.jpg",
  description: "Flaky and layered flatbread, perfect with curries.",
},
{
  name: "MYSORE BONDA",
  category: "tiffins",
  image: "./img/mysore_bonda.jfif",
  description: "Crispy and savory fritters from Mysore.",
},
{
  name: "GHEE IDLY",
  category: "tiffins",
  image: "./img/ghee_idly.jfif",
  description: "Soft idlies drizzled with pure ghee.",
},
{
  name: "VADA",
  category: "tiffins",
  image: "./img/vada.jpg",
  description:
    "Crispy and savory lentil fritters, often served with sambar.",
},
{
  name: "POORI",
  category: "tiffins",
  image: "./img/poori.jpg",
  description:
    "Puffed and golden deep-fried bread, typically served with potato curry.",
},
]; -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Our Products</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="res-items.css" />
    <link rel="stylesheet" href="../layouts/nav.css" />
    <link rel="stylesheet" href="../layouts/footer.css" />
    <script>
      fetch("../layouts/nav.html")
        .then((response) => response.text())
        .then((navbarHTML) => {
          document.getElementById("navbar-container").innerHTML = navbarHTML;
        });
    </script>
    <script>
      fetch("../layouts/footer.html")
        .then((response) => response.text())
        .then((footerHTML) => {
          document.getElementById("footer-container").innerHTML = footerHTML;
        });
    </script>
  </head>
  <body>
    <div id="navbar-container"></div>

    <div class="container">
      <div class="add-item-button-container">
        <button
          class="btn btn-primary add-item-btn"
          id="add-item-btn"
          data-toggle="modal"
          data-target="#editItemModal"
        >
          <i class="fas fa-plus"></i> Add New Item
        </button>
      </div>

      <div class="product-grid" id="product-list"></div>
    </div>

    <div
      class="modal fade"
      id="productModal"
      tabindex="-1"
      aria-labelledby="productModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="productModalLabel"></h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="productModalBody"></div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Add to Cart</button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="editItemModal"
      tabindex="-1"
      aria-labelledby="editItemModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div
            class="modal-header"
            style="background-color: var(--primary); color: var(--secondary)"
          >
            <h5 class="modal-title" id="editItemModalLabel">
              Add/Edit Food Item
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
              style="color: var(--secondary)"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="editItemModalBody"></div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="saveEditItem">
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const productListContainer = document.getElementById("product-list");
      const productModal = $("#productModal");
      const productModalLabel = document.getElementById("productModalLabel");
      const productModalBody = document.getElementById("productModalBody");
      const addItemBtn = document.getElementById("add-item-btn");
      const editItemModal = $("#editItemModal");
      const editItemModalBody = document.getElementById("editItemModalBody");
      const saveEditItemBtn = document.getElementById("saveEditItem");
      let currentEditItemId = null;
      let fooditem = []; // Initialize as an empty array

      function renderProducts(products) {
        productListContainer.innerHTML = "";
        if (products.length === 0) {
          productListContainer.innerHTML =
            '<p class="text-center">No items found.</p>';
          return;
        }
        products.forEach((product) => {
          const productName = product.foodName
            ? product.foodName
            : "No Name"; // Provide a default value
          const card = document.createElement("div");
          card.classList.add("product-card", "mb-3", "col-md-4");
          card.innerHTML = `
            <img src="${
              product.image || ""
            }" alt="${productName}" class="img-fluid" style="height: 200px; object-fit: cover;">
            <div class="product-info p-3">
                <h4>${productName}</h4>
                <div class="product-meta mb-2">
                    ${
                      product.rating
                        ? `<span class="rating">⭐ ${product.rating}</span>`
                        : ""
                    }
                    ${product.cuisine ? `<span>${product.cuisine}</span>` : ""}
                </div>
                <p class="mb-2">${
                  product.description || "No description available."
                }</p>
                <div class="product-actions d-flex justify-content-end gap-2">
                    <button class="btn btn-sm btn-info product-details-btn" data-product-id="${
                      product.foodItemId
                    }" data-toggle="modal" data-target="#productModal">Details</button>
                    <button class="btn btn-sm btn-success edit-item-btn" data-product-id="${
                      product.foodItemId
                    }" data-toggle="modal" data-target="#editItemModal">Edit</button>
                    <button class="btn btn-sm btn-danger remove-item-btn" data-product-id="${
                      product.foodItemId
                    }">Remove</button>
                </div>
            </div>
        `;
          productListContainer.appendChild(card);
        });
      }

      // Function to fetch food items from the API
      async function fetchFoodItems() {
        const apiUrl =
          "http://localhost:8081/customer/restaurants/1/food-items";
        try {
          const response = await fetch(apiUrl);
          console.log("Raw Response:", response);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.text(); // Get the response as text first
          console.log("Response Text:", data);
          fooditem = JSON.parse(data); // Then try to parse it as JSON
          renderProducts(fooditem);
        } catch (error) {
          console.error("Error fetching food items:", error);
          productListContainer.innerHTML =
            '<p class="text-center text-danger">Failed to load food items.</p>';
        }
      }

      // Initial fetch of food items
      fetchFoodItems();

      productModal.on("show.bs.modal", function (event) {
        const button = $(event.relatedTarget);
        const productId = button.data("product-id");
        const selectedProduct = fooditem.find(
          (item) => item.foodItemId && item.foodItemId.toString() === productId
        );

        if (selectedProduct) {
          productModalLabel.textContent = selectedProduct.name.replace(
            /_/g,
            " "
          );
          productModalBody.innerHTML = `
                    ${
                      selectedProduct.image
                        ? `<img src="${selectedProduct.image}" class="img-fluid mb-3" alt="${selectedProduct.name}">`
                        : ""
                    }
                    ${
                      selectedProduct.cuisine
                        ? `<p><strong>Cuisine:</strong> ${selectedProduct.cuisine}</p>`
                        : ""
                    }
                    ${
                      selectedProduct.rating
                        ? `<p><strong>Rating:</strong> ⭐ ${selectedProduct.rating}</p>`
                        : ""
                    }
                    ${
                      selectedProduct.description
                        ? `<p><strong>Description:</strong> ${selectedProduct.description}</p>`
                        : "<p>No detailed description available.</p>"
                    }
                `;
        } else {
          productModalLabel.textContent = "Product Details";
          productModalBody.textContent = "Could not load product details.";
        }
      });

      productListContainer.addEventListener("click", function (event) {
        const target = event.target;
        const productIdToRemove = target.dataset.productId;

        if (target.classList.contains("remove-item-btn")) {
          if (productIdToRemove) {
            fetch(`/api/food-items/${productIdToRemove}`, { method: "DELETE" }) // Adjust API endpoint if needed
              .then((response) => {
                if (!response.ok) {
                  console.error("Failed to remove item from server.");
                  // Optionally show an error message
                } else {
                  // Remove from local array and re-render
                  fooditem = fooditem.filter(
                    (item) => item.foodItemId.toString() !== productIdToRemove
                  );
                  renderProducts(fooditem);
                  console.log("Item removed successfully.");
                }
              })
              .catch((error) => {
                console.error("Error removing item:", error);
                // Optionally show an error message
              });
          }
        } else if (target.classList.contains("edit-item-btn")) {
          currentEditItemId = productIdToRemove;
          const itemToEdit = fooditem.find(
            (item) =>
              item.foodItemId &&
              item.foodItemId.toString() === currentEditItemId
          );
          if (itemToEdit) {
            populateEditModal(itemToEdit);
            editItemModal.modal("show");
          }
        }
      });

      addItemBtn.addEventListener("click", function () {
        populateEditModal({}); // Pass an empty object for adding a new item
        editItemModal.modal("show");
        currentEditItemId = null; // Reset for adding
      });

      function populateEditModal(item) {
        const formHtml = `
                <form id="editForm">
                    <div class="form-group">
                        <label for="edit-name">Name</label>
                        <input type="text" class="form-control" id="edit-name" value="${
                          item.name || ""
                        }" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-category">Category</label>
                        <input type="text" class="form-control" id="edit-category" value="${
                          item.category || ""
                        }">
                    </div>
                    <div class="form-group">
                        <label for="edit-cuisine">Cuisine</label>
                        <input type="text" class="form-control" id="edit-cuisine" value="${
                          item.cuisine || ""
                        }">
                    </div>
                    <div class="form-group">
                        <label for="edit-rating">Rating</label>
                        <input type="number" class="form-control" id="edit-rating" min="0" max="5" step="0.1" value="${
                          item.rating || ""
                        }">
                    </div>
                    <div class="form-group">
                        <label for="edit-image">Image URL</label>
                        <input type="text" class="form-control" id="edit-image" value="${
                          item.image || ""
                        }">
                    </div>
                    <div class="form-group">
                        <label for="edit-description">Description</label>
                        <textarea class="form-control" id="edit-description">${
                          item.description || ""
                        }</textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            `;
        editItemModalBody.innerHTML = formHtml;

        const editForm = document.getElementById("editForm");
        editForm.addEventListener("submit", handleEditSubmit);
      }

      function handleEditSubmit(event) {
        event.preventDefault();
        const name = document.getElementById("edit-name").value;
        const category = document.getElementById("edit-category").value;
        const cuisine = document.getElementById("edit-cuisine").value;
        const rating = parseFloat(document.getElementById("edit-rating").value);
        const image = document.getElementById("edit-image").value;
        const description = document.getElementById("edit-description").value;

        const updatedItem = {
          name,
          category,
          cuisine,
          rating,
          image,
          description,
        };

        const apiUrl = "/api/food-items"; // Adjust base API URL if needed

        if (currentEditItemId) {
          // Editing existing item
          fetch(`${apiUrl}/${currentEditItemId}`, {
            method: "PUT", // Or PATCH
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updatedItem),
          })
            .then((response) => {
              if (!response.ok) {
                console.error("Failed to update item on server.");
                // Optionally show an error message to the user
              } else {
                const indexToUpdate = fooditem.findIndex(
                  (item) =>
                    item.foodItemId &&
                    item.foodItemId.toString() === currentEditItemId
                );
                if (indexToUpdate !== -1) {
                  fooditem[indexToUpdate] = {
                    ...fooditem[indexToUpdate],
                    ...updatedItem,
                  };
                  renderProducts(fooditem);
                }
                editItemModal.modal("hide");
                const editForm = document.getElementById("editForm");
                editForm.removeEventListener("submit", handleEditSubmit);
                currentEditItemId = null;
              }
            })
            .catch((error) => {
              console.error("Error updating item:", error);
              // Optionally show an error message to the user
            });
        } else {
          // Adding a new item
          fetch(apiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updatedItem),
          })
            .then((response) => response.json())
            .then((newItem) => {
              fooditem.push(newItem);
              renderProducts(fooditem);
              editItemModal.modal("hide");
              const editForm = document.getElementById("editForm");
              editForm.removeEventListener("submit", handleEditSubmit);
              currentEditItemId = null;
            })
            .catch((error) => {
              console.error("Error adding item:", error);
              // Optionally show an error message
            });
        }
      }
    </script>

    <div id="footer-container"></div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
